## ML-ALS

### 前提

ALS 的核心假设是：打分矩阵A是近似低秩的，即一个$m∗n$ 的打分矩阵 A可以用两个小矩阵$U(m∗k)$ 和$V(n∗k)$ 的乘积来近似：$A≈UV^T$  , $k<<m,n$  

如果评分理解成相似度，那么评分矩阵$A(m∗n)$ 就可以由用户喜好特征矩阵$U(m∗k)$ 和产品特征矩阵$V(n∗k)$ 的乘积。



### 损失函数

我们使用用户喜好特征矩阵$U(m∗k)$ 中的第$i$ 个用户的特征向量$u_i$ ，和产品特征矩阵$V(n∗k)$ 第$j$ 个产品的特征向量$v_j$ 来预测打分矩阵$A(m∗n)$ 中的 $a_{ij}$  。我们可以得出一下的矩阵分解模型的损失函数为：

​							$$ C=∑_{(i,j)∈R}[(a_{ij}−u_iv^T_j)^2+λ(u^2_i+v^2_j)] $$

有了损失函数之后，下面就开始介绍优化方法。通常的优化方法分为两种：

*  交叉最小二乘法（alternative least squares）

* 随机梯度下降法（stochastic gradient descent）



### ALS算法原理

ALS算法的思想就是：先随机生其中一个变量，然后后固定它求解另一个变量，再固定求解，这样交替进行下去，直到取得最优解$min(C)$ 。因为每步迭代都会降低误差，并且误差是有下界的，所以 ALS 一定会收敛。但由于问题是非凸的，ALS 并不保证会收敛到全局最优解。但在实际应用中，ALS 对初始点不是很敏感，是否全局最优解造成的影响并不大。

算法的执行步骤：

1. 先随机生成一个。一般可以取0值或者全局均值。
   固定，即认为是已知的常量，来求解： 
              $$ C=∑_{(i,j)∈R}[(a_{ij}−u^{(0)}_iv^T_j)^2+λ((u^2_i)^{(0)}+v^2_j)]$$ 

2. 由于上式中只有$v_j$ 一个未知变量，因此C的最优化问题转化为最小二乘问题，用最小二乘法求解$v_j$的最优解： 
   固定$j, j∈(1,2,...,n)$ ，则：等式两边关于为$v_j$ 求导得：

   ​		$\frac{d(C)}{d({v_j})}=\frac{d}{d(v_j)}∑_{i=1}^m[(a_{ij}−u^{(0)}_iv^T_j)^2+λ((u^2_i)^{(0)}+v^2_j)]$		

    				$=∑_{i=1}^m[2(a_{ij}−u^{(0)}_iv^T_j)(−(u^T_i)^{(0)})+2λv_j]$

   ​				 $=2∑_{i=1}^m[(u^{(0)}_i(u^T_i)^{(0)}+λ)v_j−a_{ij}(u^T_i)^{(0)}]$

   令$\frac{d(C)}{d(v_j)}=0$，可得： 
                  $∑_{i=1}^m[(u^{(0)}_i(u^T_i)^{(0)}+λ)v_j]=\sum_{i=1}^ma_{ij}(u^T_i)^{(0)}$

   ​               $=>(U^{(0)}(U^T)^{(0)}+λE)v_j=a^T_jU^{(0)}$ 

   令$ M_1=U^{(0)}(U^T)^{(0)}+λE,M_2=a^T_jU^{(0)}$，则

   ​				$v_j=M^{−1}_1M_2$ 

   按照上式依次计算$v_1，v_2，...，v_n$ ，从而得到$V^{(0)}$ 

3. 同理，用步骤2中类似的方法: 
            $C=∑_{(i,j)∈R}[(a_{ij}−u_i(v^T_j)^{(0)})^2+λ(u^2_i+(v^2_j)^{(0)})]$  

   固定$i,i∈(1,2,...,m)$ ，则：等式两边关于为$u_i$ 求导得：
           $\frac{d(C)}{d(u_i)}=\frac{d}{d(u_i)}∑_{j=1}^n[(a_{ij}−u_i(v^T_j)^{(0)})^2+λ((u^2_i)+(v^2_j)^{(0)})]$  

   ​				 $=∑_{j=1}^n[2(a_{ij}−u_i(v^T_j)^{(0)})(−(v^T_j)^{(0)})+2λu_i]$  

   ​				 $=2∑_{j=1}^n[(v^{(0)}_j(v^T_j)^{(0)}+λ)u_i−a_{ij}(v^T_j)^{(0)}]$
   令$\frac{d(C)}{d(u_i)}=0$，可得： 
   ​				$∑_{j=1}^n[(v^{(0)}_j(v^T_j)^{(0)}+λ)u_i]=∑_{j=1}^na_{ij}(v^T_j)^{(0)}$

   ​				$=>((V^{(0)}(V^T)^{(0)}+λE)u_i=a^T_iV^{(0)}$

​       令$ M_1=V^{(0)}(V^T)^{(0)}+λE,M_2=a^T_iV^{(0)}$，则$u_i=M^{−1}_1M_2$ 

4. 按照上式依次计算$u_1，u_2，...，u_n$ ，从而得到$U^{(1)}$ 
   循环执行步骤2、3，直到损失函数C的值收敛（或者设置一个迭代次数N，迭代执行步骤2、3，N次后停止）。这样，就得到了C最优解对应的矩阵U、V



======================================================================================================================================================================================================================================================================================================================================================================================================

### 后续补充：ALS、SVD的区别

